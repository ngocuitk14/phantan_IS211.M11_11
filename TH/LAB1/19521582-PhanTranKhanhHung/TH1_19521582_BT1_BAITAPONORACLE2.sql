CREATE TABLE BaiTapHTTT2.USER_NEW
(
    U_ID VARCHAR2(3) CONSTRAINT PK_USERNEW PRIMARY KEY,
    USERNAME VARCHAR2(10),
    PASS VARCHAR2(10),
    REGDAY DATE,
    NATIONALITY VARCHAR(10)
);
CREATE TABLE BaiTapHTTT2.CHANNEL
(
    CHANNELID VARCHAR(4) CONSTRAINT PK_TUYEN PRIMARY KEY,
    CNAME VARCHAR(20) NOT NULL,
    SUBSCRIBES NUMBER(4) NOT NULL, 
    OWNNER VARCHAR(3),
    CREATED DATE
);
CREATE TABLE BaiTapHTTT2.VIDEO
(
    VIDEOID VARCHAR(7)  CONSTRAINT PK_KHACHHANG PRIMARY KEY,
    TITLE VARCHAR(50),
    DURATION_ VARCHAR(3),
    AGE NUMBER(2)
);
CREATE TABLE BaiTapHTTT2.SHARE_NEW
(
    VIDEOID VARCHAR(7),
    CHANNELID VARCHAR(4),
    CONSTRAINT PK_SHARE PRIMARY KEY(VIDEOID, CHANNELID)
);

ALTER SESSION SET NLS_DATE_FORMAT =' DD/MM/YYYY HH24:MI:SS ';
ALTER USER BaiTapHTTT2 quota 100M on "USERS";
ALTER TABLE BaiTapHTTT2.CHANNEL ADD CONSTRAINT FK_USER_OWNNER FOREIGN KEY(OWNNER) REFERENCES BaiTapHTTT2.USER_NEW(U_ID);
ALTER TABLE BaiTapHTTT2.SHARE_NEW ADD CONSTRAINT FK_SHARE_VIDEOID FOREIGN KEY(VIDEOID) REFERENCES BaiTapHTTT2.VIDEO(VIDEOID);
ALTER TABLE BaiTapHTTT2.SHARE_NEW ADD CONSTRAINT FK_SHARE_CHANNELID FOREIGN KEY(CHANNELID) REFERENCES BaiTapHTTT2.CHANNEL(CHANNELID);

INSERT INTO BaiTapHTTT2.USER_NEW VALUES ('001', 'faptv', '123456abc', '01/01/2014', 'VIETNAM');
INSERT INTO BaiTapHTTT2.USER_NEW VALUES ('002', 'kemxoitv', '@147869iii', '05/06/2015', 'Campuchia');
INSERT INTO BaiTapHTTT2.USER_NEW VALUES ('003', 'openshare', 'qwertyuiop', '12/05/2009', 'VIETNAM');

INSERT INTO BaiTapHTTT2.CHANNEL VALUES ('C120', 'faptv', 2343,'001', '02/01/2014');
INSERT INTO BaiTapHTTT2.CHANNEL VALUES ('C905', 'kemxoitv', 1032,'002', '09/07/2015');
INSERT INTO BaiTapHTTT2.CHANNEL VALUES ('C357', 'opensharecafe', 5064,'003', '10/12/2009');

INSERT INTO BaiTapHTTT2.VIDEO VALUES ('V100229', 'faptv com nguoi tap 41 - dot nhap','469',18);
--INSERT INTO BaiTapHTTT2.VIDEO VALUES ('V100230', 'Tyson Fury vs Deontay Wilder 3','987',20);
INSERT INTO BaiTapHTTT2.VIDEO VALUES ('V211002', 'kemxoi: tap 31 - may kool tinh yeu cua anh', '312',16);
INSERT INTO BaiTapHTTT2.VIDEO VALUES ('V400002', 'Noi tinh yeu ket thuc - Hoang Tuan', '378',0);

INSERT INTO BaiTapHTTT2.SHARE_NEW VALUES ('V100229', 'C905');
--INSERT INTO BaiTapHTTT2.SHARE_NEW VALUES ('V100229', 'C120');
INSERT INTO BaiTapHTTT2.SHARE_NEW VALUES ('V211002', 'C120');
INSERT INTO BaiTapHTTT2.SHARE_NEW VALUES ('V400002', 'C357');

--Cau 5 
SELECT * 
FROM BaiTapHTTT2.VIDEO 
where (AGE >= 16);
--Cau 6 
SELECT *  
FROM BaiTapHTTT2.CHANNEL 
ORDER BY SUBSCRIBES DESC 
FETCH FIRST 1 ROWS ONLY;
--CAu 7
SELECT BaiTapHTTT2.VIDEO.VIDEOID, COUNT(CHANNELID) 
FROM BaiTapHTTT2.VIDEO, BaiTapHTTT2.SHARE_NEW
WHERE BaiTapHTTT2.VIDEO.VIDEOID = BaiTapHTTT2.SHARE_NEW.VIDEOID AND (AGE >= 18) 
GROUP BY BaiTapHTTT2.VIDEO.VIDEOID;
--Cau 8
SELECT * 
FROM BaiTapHTTT2.VIDEO VI
WHERE NOT EXISTS (
    SELECT *
    FROM BaiTapHTTT2.CHANNEL C
    WHERE NOT EXISTS (
        SELECT * 
        FROM BaiTapHTTT2.SHARE_NEW SN 
        WHERE VI.VIDEOID = SN.VIDEOID AND C.CHANNELID = SN.CHANNELID
    )
);

        
    
    
    